<?xml version="1.0" encoding="UTF-8"?>
<Export generator="IRIS" version="26" zv="IRIS for UNIX (Ubuntu Server LTS for x86-64 Containers) 2020.1 (Build 215U)" ts="2020-04-10 13:34:16">
<Class name="Demo.EKGRouter">
<Description>
</Description>
<Super>Ens.BusinessProcessBPL</Super>
<TimeChanged>65476,67612.293227</TimeChanged>
<TimeCreated>65476,51871.453526</TimeCreated>

<XData name="BPL">
<Description>
BPL Definition</Description>
<XMLNamespace>http://www.intersystems.com/bpl</XMLNamespace>
<Data><![CDATA[
<process language='objectscript' request='EnsLib.MQTT.Message' response='Ens.Response' height='2000' width='2000' >
<context>
<property name='PatientID' type='%String' instantiate='0' >
<parameters>
<parameter name='MAXLEN'  value='50' />
</parameters>
</property>
<property name='Topic' type='%String' instantiate='0' >
<parameters>
<parameter name='MAXLEN'  value='50' />
</parameters>
</property>
<property name='Reading' type='Demo.HeartRate' instantiate='0' />
</context>
<sequence xend='200' yend='450' >
<transform name='Transform' class='Demo.EnsMessageToReading' source='request' target='context.Reading' xpos='200' ypos='250' />
<code xpos='204' ypos='349' >
<![CDATA[ set st = context.Reading.%Save()
 $$$TRACE(st)]]]]><![CDATA[>
</code>
</sequence>
</process>
]]></Data>
</XData>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
</Storage>
</Class>


<Class name="Demo.EnsMessageToReading">
<Super>Ens.DataTransformDTL</Super>
<TimeChanged>65479,48758.066203</TimeChanged>
<TimeCreated>65476,65426.882794</TimeCreated>
<DependsOn>EnsLib.MQTT.Message,Demo.HeartRate</DependsOn>

<Parameter name="IGNOREMISSINGSOURCE">
<Default>1</Default>
</Parameter>

<Parameter name="REPORTERRORS">
<Default>1</Default>
</Parameter>

<Parameter name="TREATEMPTYREPEATINGFIELDASNULL">
<Default>0</Default>
</Parameter>

<XData name="DTL">
<XMLNamespace>http://www.intersystems.com/dtl</XMLNamespace>
<Data><![CDATA[
<transform sourceClass='EnsLib.MQTT.Message' targetClass='Demo.HeartRate' create='new' language='objectscript' >
<assign value='..Piece(source.Topic,"/",4)' property='target.PatientID' action='set' />
<assign value='source.StringValue' property='target.BPM' action='set' />
<assign value='..Lookup("Providers",target.PatientID)' property='target.Provider' action='set' />
</transform>
]]></Data>
</XData>
</Class>


<Class name="Demo.HeartRate">
<Super>%Persistent,%Populate</Super>
<TimeChanged>65476,68964.662558</TimeChanged>
<TimeCreated>65476,64471.674746</TimeCreated>

<Property name="PatientID">
<Type>%String</Type>
</Property>

<Property name="Provider">
<Type>%String</Type>
<Parameter name="POPSPEC" value="ValueList(&quot;,John,Jacob,Jinglheimer&quot;)"/>
</Property>

<Property name="BPM">
<Type>%Integer</Type>
</Property>

<Property name="TimeStamp">
<Type>%DateTime</Type>
<InitialExpression>$ZDATETIME($ZTIMESTAMP)</InitialExpression>
</Property>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^Demo.HeartRateD</DataLocation>
<DefaultData>HeartRateDefaultData</DefaultData>
<IdLocation>^Demo.HeartRateD</IdLocation>
<IndexLocation>^Demo.HeartRateI</IndexLocation>
<StreamLocation>^Demo.HeartRateS</StreamLocation>
<Data name="HeartRateDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>PatientID</Value>
</Value>
<Value name="3">
<Value>Provider</Value>
</Value>
<Value name="4">
<Value>BPM</Value>
</Value>
<Value name="5">
<Value>TimeStamp</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Demo.MQTT">
<Super>Ens.Production</Super>
<TimeChanged>65479,48563.432601</TimeChanged>
<TimeCreated>65475,64378.915378</TimeCreated>

<XData name="ProductionDefinition">
<Data><![CDATA[
<Production Name="Demo.MQTT" TestingEnabled="true" LogGeneralTraceEvents="true">
  <Description></Description>
  <ActorPoolSize>2</ActorPoolSize>
  <Item Name="MQTT_TEST" Category="" ClassName="EnsLib.MQTT.Service.Passthrough" PoolSize="1" Enabled="true" Foreground="false" Comment="" LogTraceEvents="false" Schedule="">
    <Setting Target="Adapter" Name="Topic">/acmeHospital/EKG/#</Setting>
    <Setting Target="Adapter" Name="Url">tcp://mqtt.eclipse.org:1883</Setting>
    <Setting Target="Host" Name="TargetConfigNames">Demo.EKGRouter</Setting>
    <Setting Target="Adapter" Name="CleanSession">0</Setting>
  </Item>
  <Item Name="Demo.EKGRouter" Category="" ClassName="Demo.EKGRouter" PoolSize="1" Enabled="true" Foreground="false" Comment="" LogTraceEvents="true" Schedule="">
  </Item>
  <Item Name="Demo.MetricMQTT" Category="" ClassName="Demo.MetricMQTT" PoolSize="1" Enabled="true" Foreground="false" Comment="" LogTraceEvents="false" Schedule="">
  </Item>
</Production>
]]></Data>
</XData>
</Class>


<Class name="Demo.MetricMQTT">
<Super>Ens.BusinessMetric</Super>
<TimeChanged>65479,48618.748761</TimeChanged>
<TimeCreated>65479,48253.129968</TimeCreated>

<Parameter name="HISTORY">
<Default>50</Default>
</Parameter>

<Property name="BPM">
<Type>Ens.DataType.Metric</Type>
</Property>

<Method name="OnCalculateMetrics">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set patient = ..%Instance

    // find recent sales using SQL
     &SQL(SELECT BPM INTO :bpm
              FROM Demo.HeartRate
              WHERE PatientID = :patient)
    
    set ..BPM = bpm

    return $$$OK
]]></Implementation>
</Method>

<Query name="MetricInstances">
<Description>
Return current list of product names</Description>
<Type>%SQLQuery</Type>
<SqlQuery>  select distinct patientID from Demo.HeartRate</SqlQuery>
</Query>
</Class>


<Project name="EnsExportProduction_2020-04-10 13-33-45_702+0" LastModified="2020-04-10 13:34:16.253293">
  <ProjectDescription>Studio Project generated from Production 'Demo.MQTT' at 2020-04-10 13:33:45.702 UTC</ProjectDescription>
  <Items>
    <ProjectItem name="Demo.EKGRouter" type="CLS"></ProjectItem>
    <ProjectItem name="Demo.EnsMessageToReading" type="CLS"></ProjectItem>
    <ProjectItem name="Demo.HeartRate" type="CLS"></ProjectItem>
    <ProjectItem name="Demo.MQTT" type="CLS"></ProjectItem>
    <ProjectItem name="Demo.MetricMQTT" type="CLS"></ProjectItem>
    <ProjectItem name="ProductionSettings:Demo.MQTT.PTD" type="PTD"></ProjectItem>
    <ProjectItem name="EnsExportNotes.EnsExportProduction_2020-04-10 13-33-45_702+0.PTD" type="PTD"></ProjectItem>
  </Items>
</Project>


<Document name="EnsExportNotes.EnsExportProduction_2020-04-10 13-33-45_702+0.PTD"><ProjectTextDocument name="EnsExportNotes.EnsExportProduction_2020-04-10 13-33-45_702+0" description="Export Notes for export EnsExportProduction_2020-04-10 13-33-45_702+0">
<![CDATA[<Deployment>
<Creation>
<Machine>5545AAC471EF</Machine>
<Instance>IRIS</Instance>
<Namespace>USER</Namespace>
<SourceProduction>Demo.MQTT</SourceProduction>
<Username>SuperUser</Username>
<UTC>2020-04-10 13:34:16.252</UTC>
</Creation>
<Notes>
</Notes>
<Contents>
<ExportProject>EnsExportProduction_2020-04-10 13-33-45_702+0</ExportProject>
<Item num="1">Demo.EKGRouter.CLS</Item>
<Item num="2">Demo.EnsMessageToReading.CLS</Item>
<Item num="3">Demo.HeartRate.CLS</Item>
<Item num="4">Demo.MQTT.CLS</Item>
<Item num="5">Demo.MetricMQTT.CLS</Item>
<Item num="6">ProductionSettings:Demo.MQTT.PTD</Item>
</Contents>
<ProductionClassInExport>Demo.MQTT</ProductionClassInExport>
</Deployment>

]]></ProjectTextDocument>
</Document>

<Document name="ProductionSettings:Demo.MQTT.PTD"><ProjectTextDocument name="ProductionSettings:Demo.MQTT" description="Settings for production Demo.MQTT">
<![CDATA[<Production Name='Demo.MQTT' TestingEnabled='true' LogGeneralTraceEvents='true'><Description/><ActorPoolSize>2</ActorPoolSize></Production>
]]></ProjectTextDocument>
</Document></Export>
